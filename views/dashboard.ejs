<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/header') %>
</head>
<body>
  <header>
    <%- include('partials/nav') %>
  </header>
  <main>
    <h1>Your Passwords</h1>
    <div class="category-container">
      <!-- Dynamically Render Categories and Passwords -->
      <% if (passwords.length > 0) { %>
        <% const categories = {}; %>
        <% passwords.forEach(password => { %>
          <% if (password.category && !categories[password.category]) { %>
            <% categories[password.category] = []; %>
          <% } %>
          <% if (password.category) { %>
            <% categories[password.category].push(password); %>
          <% } %>
        <% }); %>

        <% for (let category in categories) { %>
          <div class="category">
            <h2><%= category %></h2>
            <div class="password-list">

              <!-- Loop through each password in the category -->
              <% categories[category].forEach(password => { %>
                <div class="password-box">
                  <!-- Red "X" button for deleting the entry -->
                  <button class="delete-button" data-id="<%= password.id %>" style="color: red; position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">✖</button>
                  <div class="password-card">
                    <p>
                      <!-- Edit Button for Site Name -->
                      <button class="edit-button" data-id="<%= password.id %>" data-field="site-name">✏️</button>
                      <strong>Site Name:</strong>
                      <span class="editable" id="site-name-<%= password.id %>"><%= password.site_name %></span>
                    </p>
                    <p>
                      <!-- Edit Button for Site URL -->
                      <button class="edit-button" data-id="<%= password.id %>" data-field="site-url">✏️</button>
                      <strong>Site URL:</strong>
                      <span class="editable" id="site-url-<%= password.id %>"><a href="<%= password.site_url %>" target="_blank"><%= password.site_url %></a></span>
                    </p>
                    <p>
                      <!-- Edit Button for Password -->
                      <button class="edit-button" data-id="<%= password.id %>" data-field="password">✏️</button>
                      <strong>Password:</strong>
                      <span class="editable" id="password-<%= password.id %>"><%= password.pass %></span>
                    </p>
                    <!-- COPY button -->
                    <div style="text-align: center; margin-top: 10px;">
                      <button class="copy-button" data-password="<%= password.pass %>" style="background-color: #007BFF; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">COPY</button>
                    </div>
                  </div>
                </div>
              <% }); %>

            </div>
          </div>
        <% } %>
      <% } else { %>
        <p>No passwords stored yet.</p>
      <% } %>
    </div>
  </main>
  <%- include('partials/footer') %>
  <script src="/vendor/jquery-3.0.0.js"></script>
  <script defer src="/scripts/dashboard.js"></script>
</body>
</html>
